# Refactoring
## 2022-04-14 Thu

## 테스트 구축
* **리팩토링은 혼자서는 존재할 수 없으며, 제대로 된 리팩토링을 위해서는 반드시 견고한 테스트 스위트가 뒷받침되어야 한다**.
* 무엇보다, 좋은 테스트 코드를 작성하는 일은 테스트 코드 작성에 드는 시간을 포함하더라도 개발 효율을 높여준다.

### 자가 테스트 코드의 가치
* 개발자들의 업무를 살펴보면, 실제로 코드를 작성하는 시간의 비중은 크지 않다.
  * 현재 상황을 파악하거나, 설계를 고민하거나, 대부분의 시간은 디버깅에 사용하곤 한다.
  * 버그 역시 수정 자체는 오래 걸리지 않으나, 버그를 찾는 시간은 끔찍하고, 길고, 고통스럽다.
  * 최악의 경우, 버그를 수정하는 과정에서 새로운 버그를 심기도 한다.
* 잘 작성된 테스트 코드가 뒷받침되는 경우, 다음과 같은 이유에서 디버깅 시간은 크게 줄어들고 생산성이 늘어난다.
  1. 모든 테스트는 완전히 자동화되며, 결과까지 스스로 검사한다.
  2. **테스트를 자주 수행하던 와중 테스트에 통과하지 못한 경우, 이전 작업 분량에서부터 추가된 코드 사이에 버그가 존재함**을 알 수 있다.
  3. 테스트를 자주 수행하므로 의심되는 코드의 양은 많지 않고, 기억도 생생하니 금방 디버깅할 수 있다.
* 이렇듯 **자가 테스트 코드 자체 뿐만 아니라, 테스트를 자주 수행하는 습관도 버그를 찾는 강력한 도구가 되어준다**.
```
> 모든 테스트는 완전히 자동화되고, 결과까지 스스로 검사할 수 있어야 한다.
> 테스트 스위트는 강력한 버그 검출 도구이며, 디버깅에 드는 시간을 대폭 줄여줄 수 있다.
```

### 테스트 코드 작성의 어려움
* 테스트 코드를 작성하기 어려운 요인 중 하나는 다른 개발자를 설득하는 일이며, 크게 다음과 같은 사유가 있다.
  1. 테스트를 작성하려면 소프트웨어 자체적인 기능 외의 코드를 상당량 작성해야 한다.
  2. 테스트 작성법을 배운 적이 없는 개발자가 많다.
* 물론 수동으로 진행하는 테스트는 지겨운 일이지만, 자동화하는 데에 성공한다면 테스트 코드를 작성하는 재미를 느낄 수 있다.

### 테스트 주도 개발
```
> 테스트 주도 개발이란 테스트 코드부터 작성하는 습관을 바탕으로 창시된 기법이다.
```
* **테스트 코드를 작성하기 가장 좋은 시점은 프로그래밍을 시작하기 전**이다.
* 테스트 코드를 작성하다 보면 원하는 기능을 추가하기 위해 무엇이 필요할지 고민하게 된다.
  * 즉, **구현보다 인터페이스에 집중하게 된다는 장점이 수반**된다.
* 또한 테스트 코드를 모두 통과하는 시점은 개발이 완료되는 시점이므로, 코딩이 완료되는 시점을 정확히 판단할 수 있다.
* 테스트 주도 개발에서는 크게 다음과 같이 분류된 과정을 따라 개발을 진행한다.
  1. 처음부터 통과하지 못한다는 사실이 자명한 테스트 코드부터 작성한다.
  2. 테스트를 통과할때까지 코드를 작성한다.
  3. 테스트에 통과했다면, 결과 코드를 적절히 리팩토링한다.
  4. 상술한 과정을 짧은 주기로 반복하여 개발한다.
* **상술한 과정은 테스트 - 코딩 - 리팩토링 과정을 짧은 시간에도 여러 차례 반복적으로 수행하므로, 코드를 생산적이면서도 차분하게 작성해나갈 수 있다**.

### 리팩토링과 테스트 코드
* **리팩토링에는 테스트가 반드시 필요하므로, 제대로 된 리팩토링을 위해서는 테스트 코드를 반드시 작성**해야 한다.
  * 코드를 작성할 때에는 반드시 테스트 코드도 함께 작성한다.
  * 만약 **테스트 코드가 갖추어지지 않은 코드를 리팩토링해야 한다면, 리팩토링하기에 앞서 자가 테스트 코드를 작성**하도록 한다.