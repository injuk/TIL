# Refactoring
## 2022-04-15 Fri

## 기본적인 리팩토링
* 가장 많이 사용되는 리팩토링은 함수 추출하기와 변수 추출하기이다.
  * 이러한 함수 구성과 이름 짓기는가 가장 기본적인 저수준의 리팩토링에 해당한다.
  * 또한, 반대로 진행하는 함수 인라인하기와 변수 인라인하기도 자주 사용한다.
* 추출은 결국 명명과 같으며, 코드의 이해도가 높아지다 보면 이름을 바꾸어야 하는 경우가 많다.

### 함수 추출하기
* 코드 조각을 찾아 무슨 일을 수행하는지 파악한 후, 독립된 함수로 추출하고 적절히 명명하는 리팩토링 기법에 해당한다.
  * 가장 자주 사용되는 리팩토링 기법이기도 하다.
* **코드 조각의 목적과 구현을 분리하는 방식은 독립된 함수로 구분하는 좋은 기준**이다.
  * 즉, **코드를 보고 무슨 일을 하는지 파악하기가 오래 걸리는 코드는 함수로 추출하고 '무슨 일'에 맞는 이름을 붙여준다**.
  * 이를 통해 함수의 내부 구현은 신경 쓰지 않고, 함수의 이름만으로 목적을 파악할 수 있다.
  * 내부적으로 reverse()만을 호출하는 highlight()의 예시처럼, **코드의 목적과 구현 사이의 차이가 클수록 함수로 추출했을 때 얻는 이점은 크다**.
* 짧은 함수를 많이 만들면 성능에 영향을 주리라고 걱정할 수도 있으나, 짧은 함수는 오히려 캐싱하기가 쉬우므로 컴파일러가 최적화하는 데에는 유리하다.
* **짧은 함수의 이점은 명명이 잘 되었을 때에만 발휘되므로, 반드시 명명에는 신경을 써주어야 한다**.
  * 긴 함수에는 코드 덩어리마다 주석이 달려 있을 확률이 높으며, 해당 코드 덩어리를 추출하는 함수의 이름을 지을 때 주석의 내용을 참고하여 명명할 수 있다.

### 함수 추출하기 - 절차
1. 함수를 새로 만들고 목적이 잘 드러나는 이름을 붙여준다.
   * 이 때, **함수의 이름은 어떻게보다는 무엇을 하는지 잘 드러나야 한다**.
   * 적절한 이름이 떠오르지 않는다면 일반적으로 함수로 추출하면 안 된다는 신호이다.
   * **중첩 함수를 지원하는 언어의 경우, 추출된 함수를 기존 함수 안에 중첩**시킨다.
2. 추출할 코드를 원본 함수에서 복사하여 새로운 함수에 붙여 넣는다.
3. 추출한 코드 중 원본 함수의 지역 변수를 참조하거나, 추출한 함수의 유효 범위를 벗어나는 변수를 매개변수로 전달한다.
   * **중첩 함수로 추출한 경우, 내부 함수는 외부 함수의 변수에 접근할 수 있으므로 이러한 문제가 생기지 않는다**.
   * 가장 간단한 경우는 변수를 사용하지만 값을 수정하지 않는 경우이며, 이 때에는 그냥 매개변수로 넘겨주면 된다.
   * 반면 지역 변수의 값을 수정하면서도 추출한 함수 외부에서도 사용해야 하는 경우, 해당 값을 반환해야 한다. 
   * **값을 반환할 변수가 여럿이라면, 되도록이면 함수가 값 하나만을 반환하도록 여러 함수로 나눈다**.
4. **우선 컴파일 해보고 아직 미처 처리하지 못한 변수가 있는지 확인**한다.
5. 원본 함수에서 추출한 코드 부분을 새로 만든 함수를 호출하는 문장으로 변경한다.
   * 추출한 함수를 최상위 수준 문맥으로 이동해야 하는 경우, 실제로 문맥을 옮겨보기 전에는 알 수 없는 것이 많다.
   * 때문에 **중첩 함수로 추출할 수 있더라도 최소한 원본 함수와 같은 수준의 문맥으로 먼저 추출해보는 것이 바람직**하다.
   * 이를 통해 코드를 제대로 추출했는지 즉각 판별할 수 있게 된다.
6. 테스트한다.
7. 다른 코드에 추출한 함수와 같은 코드가 있는지 확인하고, 있다면 추출한 함수를 호출하도록 수정할지 검토한다.