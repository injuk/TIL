# CleanWebApplication
## 2022-03-21 Mon

## 경계 간 매핑
### 매핑하지 않기
* 매핑하지 않는 전략은 웹, 애플리케이션, 영속성 등에서 같은 모델을 사용하는 방식이다.
* 이 경우, 모델은 웹 계층과 영속성 계층으로부터의 어노테이션 요구사항을 충족해야 하지만 이는 도메인과 애플리케이션 계층에는 필요 없는 정보에 해당한다.
  * 이러한 모델은 웹, 애플리케이션, 영속성 각각의 변경의 이유를 충족시켜야하므로 단일 책임 원칙을 위반한다.
* 반면 간단한 CRUD 유즈케이스에서는 매핑하지 않는 전략이 완벽하게 들어맞을 수 있다.
  * 모든 계층이 완벽하게 같은 구조의, 같은 정보를 필요로 한다면 이러한 전략을 적용해볼 수 있다.
  * 그러나 애플리케이션 또는 도메인 계층이 웹이나 영속성 문제를 다루게 되는 상황에서는 바로 다른 전략을 적용해야 한다.
* **매핑하기, 또는 매핑하지 않기 어떤 전략을 사용했더라도 추후에 쉽게 변경**할 수 있다.
  * 일반적인 유즈케이스는 간단한 CRUD에서 시작하여 프로젝트가 성숙함에 따라 비싼 매핑 전략을 필요로 하는 유즈케이스로 바뀌어간다.

### 양방향 매핑
* 각 계층이 전용 모델을 갖고 매핑하는 전략이다.
  * 예를 들어 웹 계층에서는 웹 모델을 인커밍 포트에 필요한 도메인 모델로 매핑하고, 반환된 도메인 객체를 다시 웹 모델로 매핑한다.
* 이러한 매핑 전략의 장점은 다음과 같다.
  1. 웹이나 영속성 관심사로 오염되지 않는 깨끗한 도메인 모델을 가질 수 있다.
  2. 단일 책임 원칙을 만족한다.
  3. 매핑하지 않는 전략 다음으로 간단하다.
* 이러한 매핑 전략 역시 최고의 방법은 아니며, 다음과 같은 단점을 갖는다.
  1. 너무 많은 보일러 플레이트 코드가 생긴다.
  2. 인커밍 포트와 아웃고잉 포트의 입력 및 반환값으로 도메인 모델이 사용되므로, 도메인 모델이 계층 경계를 넘어서 사용된다.
* 아주 간단한 CRUD 유즈케이스라면 양방향 매핑 전략은 과한 선택이다.
  * **어떤 매핑 전략도 정답은 없으므로, 유즈케이스마다 적절한 전략을 사용하는 것이 바람직**하다.

### 완전 매핑 전략
* 해당 매핑 전략에서는 모든 연산마다 전용의 입출력 모델을 사용한다.
  * 계층 경계를 넘어야할 때 도메인 모델을 사용하는 대신 커맨드, 요청 객체를 별도로 정의하여 사용한다.
* 모든 계층 간 통신에 전용 모델을 사용하므로, 다른 매핑 전략보다 많은 코드가 필요하다.
  * 그러나 이러한 매핑 방법은 여러 유즈케이스의 요구사항을 함께 다뤄야하는 매핑에 비해 구현과 유지보수는 쉽다.
* 이러한 매핑 전략을 애플리케이션 전체에 적용하는 것은 권장되지 않는다.
  * 일반적으로 웹과 애플리케이션 계층 사이에서 상태 변경 유즈케이스의 경계를 명확히할 때 유용하다.
* 또는 어떤 경우에는 연산의 입력 모델에 완전 매핑 전략을 적용하고, 도메인 객체는 매핑 없이 그대로 출력하는 것도 좋다.
* 이렇듯 **매핑 전략은 여럿을 섞을 수 있으며, 응당 섞어 사용해야만 한다**.
  * 어떠한 전략도 애플리케이션 전체에 반드시 적용될 필요는 없다.

### 단방향 매핑 전략
* 해당 전략에서는 모든 계층의 모델이 같은 인터페이스를 구현한다.
* 해당 전략에서, 도메인 객체를 외부로 전달하고자 하는 경우 매핑 없이 가능하다.
  * 도메인 객체는 인커밍, 아웃고잉 포트가 기대하는 상태 인터페이스를 구현하고 있기 때문이다.
* 외부 계층에서는 이를 받아 상태 인터페이스를 그대로 사용할지, 전용 모델로 매핑해야 할지 결정할 수 있다.
* **해당 전략에서 한 계층이 다른 계층으로부터 객체를 전달 받으면 해당 객체에서만 이용할 수 있도록 매핑하면 되며, 매핑 책임이 명확**하다.
  * 즉, 각 계층은 한 방향으로만 매핑한다.
* 그러나 매핑이 계층을 넘나들며 흩어져 있으므로, 다른 전략에 비해 개념적으로 어려운 전략이기도 하다.
* **이러한 전략은 계층 간의 모델 형태가 유사할 때 가장 효과적**이다.
  * 예를 들어, 읽기 전용 연산이라면 상태 인터페이스가 필요한 모든 정보를 제공하므로 웹 계층에서 전용 모델로 매핑할 필요가 없다.

### 언제 어떤 매핑 전략을 사용할까?
* 아쉽게도, 그 때 그 때 다른 전략을 사용하는 것이 바람직하다.
* 각각의 매핑 전략은 저마다의 장단점을 갖고 있으므로, 전략을 하나로 고정하기보다는 적시에 맞는 전략을 선택할 수 있어야 한다.
* 또한 소프트웨어는 시간에 따라 변화하므로, 기존에 최선이었던 전략이 오늘날에는 그렇지 않을 수 있음을 기억해야 한다.
  * 따라서 간단한 전략으로 시작해서, 계층 간의 결합을 분리할 수 있는 복잡한 전략으로 수정하는 것도 좋다.
* 언제 어떤 전략을 사용할지 결정할 수 있도록 팀 내 개발자들이 합의한 가이드라인이 정해져 있어야 한다.
  * 이러한 **가이드라인은 어떤 상황에서 어떤 매핑 전략을 우선적으로 적용할지 답할 수 있어야 한다**.
  * 또한 해당 전략이 왜 우선시되어야 하는지도 설명할 수 있어야 시간이 흐른 후에도 그 유효성을 평가할 수 있다.
* 사전 정의된 가이드라인은 팀 내 모든 개발자들이 숙지해야 하므로, 가이드라인은 팀 차원에서 지속적으로 논의하고 수정해 나가야 한다.

### 경계 간 매핑과 유지보수 가능한 소프트웨어
* **계층 사이를 지키는 포트들은 서로 다른 계층이 어떻게 통신할지 정의하며, 여기에는 계층 간 매핑 여부와 사용할 매핑 전략 정보도 포함**된다.
* 각 유즈케이스에 대해 좁은 포트를 정의했다면 유즈케이스마다 다른 매핑 전략을 사용할 수 있고, 다른 유즈케이스에 영향을 주지 않으면서 코드를 개선할 수 있다.
  * 따라서 적시에 최선의 전략을 쉽게 선택할 수 있게 된다.
* 상황 별로 다른 매핑 전략을 사용하는 것은 고정된 매핑 전략보다 어렵고 더 많은 소통이 필요한 일이다.
  * 그러나 이 과정에서 수립된 명확한 가이드라인은 개발 과정의 효율성과 유지보수의 용이성으로 돌아오게 된다.