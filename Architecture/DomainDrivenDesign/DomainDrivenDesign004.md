# DomainDrivenDesign
## 2022-04-28 Thu

## 도메인 서비스
* 도메인에서 일어나는 사건을 코드로 옮기는 경우, 값 객체나 엔티티로 구현하기에는 어딘가 어색한 부분이 생기는 경우가 있다.
  * 이를 해결하지 않고 억지로 값 객체, 또는 엔티티로 구현하는 경우 객체의 책임이 왜곡될 수 있다.
* 이렇듯 **어색한 느낌을 주는 행동은 별도의 객체로 분리하여 정의하는 것이 바람직하며, 이를 위해 도메인 서비스를 활용할 수 있다**.

## 서비스란?
* 소프트웨어 개발에서 말하는 **서비스는 클라이언트를 위해 '무언가'를 해주는 객체**를 말한다.
  * 그러나 '무언가'의 범위가 매우 넓고 다양하기 때문에 혼란을 주는 경우가 많다.
* 도메인 주도 설계의 경우, 서비스의 의미는 크게 다음과 같이 나누어볼 수 있다.
  1. 도메인 서비스: 도메인을 위한 서비스
  2. 애플리케이션 서비스: 애플리케이션을 위한 서비스

## 도메인 서비스란?
* 값 객체나 엔티티와 같은 도메인 객체에는 객체에 어울리는 행동을 정의할 수 있다. 
* 반면, **소프트웨어 시스템에는 값 객체 또는 엔티티에 구현하기에는 어색한 행동도 있을 수 있다**.
  * **도메인 서비스는 이러한 어색함을 해결해줄 수 있는 객체**이다.

### 값 객체나 엔티티에 정의하기에는 어색한 행동
* 사용자 가입을 예로 들어, 사용자 이름의 중복을 허용하지 않는 것은 도메인의 규칙이다.
  * 도메인의 규칙은 도메인 객체의 행동으로 정의되어야 하므로, 이러한 행동을 정의할 위치를 결정해야 한다.
* 사용자 이름이 사용자에 포함되는 속성이고, 사용자와 관련된 내용은 사용자 객체에 담는다는 이유만으로 엔티티에 행동을 추가할 수도 있다.
* 그러나 이 경우, 코드는 다음과 같이 구현되어야 한다.
  1. 새로 생성한 사용자 객체 자신에게 중복이 되었는지 확인할 것을 요청해야 한다.
  2. 또는 사용자 이름이 중복되었는지 확인하기만을 위한 별도의 사용자 객체를 만들어야 한다.
     * 이 경우, 해당 객체는 사용자를 나타내기 위한 객체이면서 사용자는 아니기 때문에 부자연스러워 보인다.
* **도메인 서비스는 이러한 부자연스러움을 해결해줄 수 있는 객체에 해당**한다.
* 도메인 서비스는 자신의 행동을 바꿀 수 있는 인스턴스만의 값을 갖지 않는다는 점에서 값 객체나 엔티티와는 차이가 있다.
* 어떤 처리를 도메인 객체 안에 정의했을 때 잘 들어맞지 않는 느낌이 드는 경우에는 해당 처리를 도메인 서비스로 옮기는 것으로 코드에 자연스럽게 나타낼 수 있다.
```
> 값 객체나 엔티티에 정의하기 부자연스러운 처리는 도메인 서비스에 정의하는 것으로 코드를 자연스럽게 만들 수 있다.
```

## 도메인 서비스의 남용
```
> 모든 처리 코드를 도메인 서비스에 작성하면 다른 도메인 객체는 데이터를 저장하기만 할 뿐, 별다른 정보를 제공할 수 없는 객체가 된다.
```
* 도메인 서비스는 엔티티나 값 객체에 정의하기에는 부자연스러운 처리에만 한정하여 정의해야 한다.
  * 그렇지 못한 경우, 모든 처리가 도메인 서비스에 정의될 수도 있다.
  * 모든 처리가 도메인 서비스에 정의되면 값 객체나 엔티티 객체에는 행동이나 도메인 규칙이 녹아들 수 없으므로, 구조체의 기능만을 갖게 된다.
  * **이러한 코드만으로는 개발자가 값 객체나 엔티티에서 유의미한 도메인 규칙을 발견할 수 없게 된다**.
* 이렇듯 자신이 제공할 수 있는 정보가 없는 도메인 객체는 데이터와 행위를 한 곳에 모아둔다는 객체 지향 설계의 기본 원칙을 위배하게 된다.

### 도메인 서비스는 최대한 피하기
* 상술했듯, 모든 행위를 도메인 서비스에 구현하는 것은 불가능하지 않지만 단점 또한 많은 방식이다.
  * 이 경우, **데이터와 행동이 단절되어 로직이 이곳저곳에 흩어지기 쉽다**.
  * 로직이 흩어지면 소프트웨어가 변화에 대응하는 유연성이 저해되고, 수정사항을 반영하기 어렵게 된다.
  * 소프트웨어의 변경에 대한 유연성을 확보하려면 이렇게 중복되는 코드를 제거하기 위한 노력을 기울여야 한다.
* **어떤 행위를 값 객체 또는 엔티티에 구현할지, 도메인 서비스에 구현할지 고민 중이라면 우선 엔티티나 값 객체에 정의하는 것이 바람직**하다.
  * **도메인 서비스에 정의하지 않으면 어색한 행위가 아닌 이상, 도메인 서비스에 행위를 구현하는 것은 최대한 지양**하도록 한다.

### 도메인 서비스의 기준
* 도메인 서비스는 도메인 모델을 코드 상에서 구현한다는 점에서는 값 객체나 엔티티와 같다.
* 반면 **데이터 저장소는 본래 도메인에는 없는 존재이며, 애플리케이션 구축을 위해 추가된 애플리케이션만의 관심사에 해당**한다.
  * 즉, 도메인 개념이나 지식만을 코드로 옮기는 대상인 도메인 객체가 데이터 저장소를 직접 다루는 것은 바람직하지 않다.
  * **도메인 객체는 오로지 도메인 모델만을 나타내야 한다**.
* **어떠한 처리를 도메인 서비스로 만들지 판단하기 위해 해당 행위가 도메인에 기초한 것인지를 판단해야 한다**.
  * 예를 들어, **도메인에 기초하지 않고 애플리케이션을 제작하는 과정에서 필요하게 된 개념은 도메인 서비스가 아닌 애플리케이션 서비스로 정의해야 한다**.
```
> 도메인 서비스 중에는 인프라와 같은 세부 사항에 관계되지 않고 도메인 객체만을 다루는 것도 있으며, 오히려 이러한 서비스가 진짜 도메인 서비스라고 할 수 있다.
```

## 결론
* 도메인에는 도메인 객체에 구현하기에는 자연스럽지 못한 행위가 존재하기 마련이다.
  * 일반적으로, 이러한 행위는 여러 객체를 가로질러 이뤄지는 처리인 경우가 많다.
  * 도메인 서비스는 이럴 때 사용할 수 있으며, 해당 처리를 정의하여 구현할 수 있다.
* **서비스는 여러모로 편리하지만, 빈약한 도메인 모델이 생기지 않으려면 어떤 행위를 어디에 구현해야할지 신중하게 결정해야 할 필요가 있다**.
* **행위가 빈약한 도메인 객체는 절차적 프로그래밍으로 변질되기 쉬우므로, 도메인 지식을 도메인 객체의 행위로 나타낼 기회를 잃게 될 수 있다**.