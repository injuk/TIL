# DomainDrivenDesign
## 2022-04-29 Fri

## 리포지토리
* 소프트웨어를 계속 성장시키려면 코드의 의도를 명확히 해야한다.
  * 반면, 데이터 저장소와 관련된 코드는 프로그램의 의도를 가리기 쉽다.
* 의도가 잘 드러나는 코드를 위해 데이터 저장소와 관련된 코드는 별도로 분리해야 하며, 리포지토리는 이러한 역할을 수행해준다.
* **리포지토리는 데이터 저장과 관련된 처리를 추상적으로 다룰 수 있게 하여 코드의 의도를 보다 명확히 드러내준다**.
  * 또한, 데이터 저장소를 교체할 때에도 리포지토리를 활용하면 변경에 대응하기 쉬우며, 결국 소프트웨어의 유연성에 기여하게 된다.

## 리포지토리란?
```
> 리포지토리는 데이터를 저장하고 복원하는 처리를 추상화하는 객체이다.
```
* 일반적인 의미와 마찬가지로, 개발에서 말하는 리포지토리 역시 데이터의 보관 장소를 의미한다.
* **소프트웨어로 도메인 개념을 표현했다고 해서 그대로 애플리케이션으로 사용 가능한 것은 아니며, 사용자를 위해 객체를 영속화할 필요가 생기기 마련**이다.
  * 예를 들어, 엔티티는 생명주기를 갖는 객체이지만 애플리케이션이 종료되면 그대로 사라지게 된다.
  * **엔티티와 같은 객체를 다시 이용하려면 데이터 저장소에 객체 데이터를 저장 또는 복원해야 할 필요**가 있다.
* **객체 인스턴스를 저장 및 복원하는 경우, 데이터 저장소에 직접 접근하는 대신 리포지토리에 저장과 복원 처리를 위임**할 수 있다.
  * 이렇듯 리포지토리를 통해 간접적으로 데이터를 처리하면 소프트웨어의 유연성은 크게 향상된다.
* **객체의 영속성과 관련된 처리를 리포지토리에 맡기는 것으로 길고 복잡한 영속성 코드로부터 해방되며, 비즈니스 로직은 더욱 순수하게 유지**할 수 있게 된다. 

### 리포지토리와 도메인 객체
* **리포지토리는 도메인의 특정 개념으로부터 유래한 개념이 아니므로, 도메인 객체가 아니며 도메인 객체와는 큰 차이가 있다**.
* 그러나 도메인 객체를 이용하여 소프트웨어를 구성하는 과정에서, 순수하게 기술적인 요소와 관련된 코드도 반드시 필요하다.
  * 이러한 **기술적인 코드가 도메인 객체와 섞이게 되면 코드의 원래 의도를 알아보기 어려워지게 된다**.
* 리포지토리는 기술적인 요소와 관련된 코드를 하나로 모아 문제 해결만을 위한 코드를 도메인 객체로부터 분리하며, 결과 도메인 객체가 더욱 돋보이게 한다.
* 즉, **도메인을 잘 드러내는 것이 목표인 도메인 주도 설계에서 리포지토리는 뗄래야 뗄 수 없는 구성 요소에 해당**한다.

## 리포지토리의 책임
```
> 리포지토리의 책임은 도메인 객체를 저장하고, 복원하는 영속성에 있다.
```
* 영속성의 기반 기술은 관계형 데이터베이스 이외에도 NoSQL 데이터베이스 등 다양하다.
* 그러나 **어떠한 기술을 사용하더라도 영속성을 구현하는 코드는 특정한 데이터 저장소를 사용하기 위한 세부사항에 결합**될 수 밖에 없다. 
  * 결과, 영속성과 관련된 코드는 도메인 객체를 침식하며 의도를 가리게 된다.
* 리포지토리의 책임은 어디까지나 객체의 영속화에 있으므로, 특정 속성의 중복 여부 등 도메인 규칙과 관련된 코드는 리포지토리의 책임을 벗어난다.
  * 즉, 리포지토리는 객체의 저장, 삭제, 수정, 복원 등의 코드만 담당할 수 있어야 한다.
  * 반면 **중복 여부 체크 등의 로직은 도메인 규칙에 가까우므로 차라리 도메인 서비스가 주체가 되는 것이 바람직**하다.