# Concurrency
## 2023-08-08 Tue
### 비동기 함수의 두 가지 분류
* 일반적으로 비동기 함수는 결과 처리 방식에 따라 두 그룹으로 분류해볼 수 있다.
  1. 결과가 없는 경우: 예를 들어 로그에 기록하고 분석 데이터를 전송하는 식의 백그라운드 작업이 있다.
  2. 결과를 반환하는 경우: 예를 들어 웹의 다른 지점으로부터 정보를 조회하는 경우가 있다.
* **두 분류 중 어느 방식이건 해당 작업에 접근하고 예외가 발생하면 이에 대응하거나, 더 이상 필요치 않은 경우에는 취소할 수 있어야 한다는 점은 같다**.

## 2023-08-09 Wed
### Job이란?
* **Job(작업)은 fire-and-forget 방식으로, 한 번 시작된 작업은 예외가 발생하지 않는 이상 대기하지 않는다**.
  * 또한, **작업은 코루틴 빌더 중 `launch()`를 사용하여 생성하는 방법이 가장 일반적**이다.
  * 또는 `Job()`과 같은 팩토리 함수를 통해 생성하는 방법 역시 가능하다.
* **작업은 인터페이스이며, `launch()`와 `Job()` 모두 `JobSupport`의 구현체를 반환한다는 공통점**을 갖는다.
  * 이 때, `JobSupport`는 작업을 확장하는 인터페이스인 `Job.Deferred`의 여러 구현체의 기반이 된다.

## 2023-08-10 Thu
### 작업의 예외 처리
* 기본적으로 **작업 내부에서 발생하는 예외는 작업을 생성한 곳까지 전파되며, 이러한 현상은 작업이 완료되지 않았더라도 발생**한다.
  * 이 경우, 해당 스레드의 `Uncaught Exception Handler`에 예외가 전파되는 것을 표준 출력으로 확인할 수 있다.

## 2023-08-11 Fri
### 작업 생명 주기
* 작업의 생명 주기는 크게 다음과 같은 다섯 가지 상태로 구성된다.
  1. New: **생성 상태이며, 존재하지만 아직 실행되지는 않은 작업을 의미**한다.
  2. Active: **활성 상태이며, 실행 중인 작업이지만 일시 중단된 작업 역시 활성 상태에 해당**한다.
  3. Completed: **완료된 상태이며, 작업이 더 이상 실행되지 않는 상황**을 의미한다.
  4. Canceling: **취소 중인 상태이며, 활성과 취소 사이의 중간 상태로서 실행 중인 작업에 대해 `cancel()` 메소드를 호출한 경우를 의미**한다.
  5. Canceled: **취소된 상태이며, 취소로 인해 실행이 완료된 것이므로 이 역시도 완료 상태로 간주**될 수 있다.
* 이 때, **기본적으로 작업은 생성 즉시 시작**되나 상황에 따라서는 즉시 실행되지 않도록 구현할 수도 있다.
  * 예를 들어, 자동으로 시작되지 않게 하고자 하는 경우에는 `GlobalScope.launch(start = CoroutineStart.LAZY) { ... }`와 같이 호출한다.
* 이렇듯 작업이 가질 수 있는 상태는 그 종류가 많으므로, 외부에서 작업의 상태를 파악하기 위해 다음과 같은 프로퍼티를 활용해볼 수 있다.
  1. `isActive`: 작업이 활성 상태인지 확인하되, 일시 중단된 경우에도 true가 반환된다.
  2. `isCompleted`: 작업 실행이 완료되었는지 확인한다.
  3. `isCancelled`: 작업이 취소되었는지 확인하며, **작업에 대한 취소 요청시 해당 프로퍼티는 즉시 true**가 된다.
* 또한, **작업은 내부적으로 완료 중(completing) 상태를 갖지만 이를 별도의 상태로 고려하지는 않아도 무방**하다.

## 2023-08-12 Sat
### 작업의 생성과 활성
* 작업은 기본적으로 `launch()` 또는 `Job()`을 활용하여 생성되며, 자동으로 시작된다.
* 생성된 작업은 일반적으로 `start()` 또는 `join()`을 활용하여 실행할 수 있다.
  1. `start()`: **작업을 시작하며, 완료를 기다리지 않는다**.
  2. `join()`: **작업을 시작하며, 작업이 완료될 때까지 실행을 일시 중단**한다.
* 상술한 특징으로 인해 **`start()`는 애플리케이션의 어느 부분에서나 호출이 가능하지만, `join()`은 일시 중단 함수 또는 코루틴에서 호출되어야 한다**.

## 2023-08-13 Sun
### 작업에 대한 취소 요청
* `cancel()` 메소드를 통해 취소 요청을 받은 활성 상태의 작업은 취소 중이라고 지칭되는 스테이징 상태로 전이된다.
  * 또는 `cancelAndJoin()` 메소드를 활용하여 작업의 실행을 취소하면서도 취소가 완료될 때까지 코루틴을 일시 중단할 수도 있다.
* 처리되지 않은 예외 또는 명시적인 취소 요청으로 종료된 작업은 취소됨 상태로 전이되며, 별도의 메소드를 통해 취소 정보를 얻을 수 있다.
* 그러나 명시적으로 취소된 작업과 처리되지 않은 예외로 실패한 작업을 구분하기 위해 다음과 같은 방법 중 하나를 사용하는 것이 바람직하다.
  1. `CoroutineExceptionHandler`를 정의하여 코루틴의 실행 인자로 넘기기
  2. `invokeOnCompletion()` 메소드 활용하기
* 또한, **작업이 정상적으로 종료된 경우와 마찬가지로 취소된 항목 역시 완료됨 상태로 간주**될 수 있다.

## 2023-08-14 Mon
### 디퍼드란?
```
> 디퍼드는 다른 언어의 퓨쳐 또는 프로미스 구현체와 유사하며, 기본적으로는 연산이 '비동기 작업이 완료될 때까지 비어있는' 객체를 반환한다는 것에 핵심을 둔다.
```
* **디퍼드는 결과를 갖는 비동기 작업을 수행하기 위한 작업의 확장으로, 라이프사이클 역시 작업과 유사하지만 반환 유형과 에러 처리 방식에 차이**가 있다.
  * 물론, 작업을 확장하므로 디퍼드 역시 대부분의 동작은 작업과 유사하다.
  * 디퍼드는 또한 `Future`와 동의어인 반면, JVM의 `java.util.concurrent.Future`와의 혼란을 피하기 위해 디퍼드로 명명되었다.
* 디퍼드는 앞서 다룬 바와 같이 `async()`를 사용하여 생성할 수 있으며, `CompletableDeferred()` 생성자를 활용할 수도 있다.