# Basics
## 2023-02-04 Sat
### 카프카의 시작
* 카프카는 LinkedIn이 데이터 수집과 분배 아키텍쳐가 파편화되어 운영 상에 어려움을 겪으면서 시작되었다.
* 크게 데이터를 생성하는 소스 애플리케이션과 이를 소비하는 타겟 애플리케이션으로 분류했을 때, 아키텍쳐가 복잡해질수록 데이터 전송 라인의 관리는 어려워진다.
  * 이 경우, **타겟 애플리케이션 중 하나에 장애가 발생하면 이와 관련이 있는 모든 소스 애플리케이션이 함께 오동작**하게 된다.
* LinkedIn은 이러한 문제를 해결하기 위해 많은 상용 프레임워크와 오픈 소스를 사용해보았지만, 결과적으로 데이터 파이프라인의 복잡성을 낮추지는 못했다.
  * 이 과정에서 다양한 메시징 플랫폼과 ETL 도구를 적용했지만, 결과는 항상 같았다.
* 결국 LinkedIn에서는 이러한 복잡성을 해결하기 위한 새로운 시스템을 개발하였고, 카프카는 각 애플리케이션 간의 연결을 중앙집중적으로 관리하며 시작되었다.

### 카프카와 FIFO
* 카프카의 내부에서 논리적으로 관리되는 파티션의 동작은 FIFO 방식으로 동작하는 큐와 유사하다.
  * 정확히는 **카프카가 내부적으로 토픽을 관리하며, 각각의 토픽은 다시 하나 이상의 파티션으로 구성**될 수 있다.
  * 때문에 **소스 애플리케이션은 타겟 애플리케이션에 신경쓰기 보다는 일단 데이터를 카프카에 적재**하는 방식으로 동작하게 된다.
* **파티션에 데이터를 삽입하는 소스 애플리케이션은 프로듀서이며 큐로부터 데이터를 소비하는 타겟 애플리케이션은 컨슈머로 지칭**될 수 있다.
* 이렇듯 **프로듀서에 의해 카프카 토픽에 삽입되는 데이터는 토픽을 구성하는 파티션 중 하나에 삽입**된다.
  * 반면, 컨슈머는 자신이 구독한 여러 파티션으로부터 데이터를 가져가 적절한 방식으로 소비한다.
  * 이 때, **중요한 것은 컨슈머가 파티션으로부터 데이터를 조회하더라도 조회된 파티션의 데이터는 삭제되지 않는 다는 특징**이다.
  * 때문에 **FIFO 구조로 인해 데이터를 조회했더라도, 해당 데이터는 다른 방식으로 다시 소비될 가능성**이 열려있다.
* **임의의 컨슈머가 데이터를 읽어들인 기록은 카프카 내부적으로 관리되며, 이러한 기록을 커밋이라는 용어로 지칭**한다.
  * 때문에 커밋을 토대로 컨슈머는 파티션의 어느 지점까지 조회했고, 어디부터 조회해야할지 알 수 있다.

## 2023-02-05 Sun
### 카프카의 특징
* 카프카는 여러 용도 중에서도 주로 데이터 파이프라인 용도로 사용되며, 이유는 크게 다음과 같은 네가지로 분류할 수 있다.
  1. 높은 처리량
  2. 높은 확장성
  3. 높은 영속성
  4. 높은 가용성
* 우선, **카프카는 프로듀서 또는 컨슈머가 데이터를 활용하는데에 있어 묶음으로 전송하는 특징이 있어 낮은 네트워크 IO와 높은 처리량이 보장**된다.
  * 이 경우, 많은 양의 데이터를 묶어 처리하므로 대용량의 실시간성 데이터를 처리하는 데에 적합하다.
  * 나아가 동일한 목적의 데이터를 여러 파티션에 분배하여 데이터를 병렬로 처리할 수 있으며, 파티션 수만큼 컨슈머 수를 늘려 처리량을 더욱 높일 수 있다.
  * 이는 일반적으로 하나의 파티션에 적재되는 데이터를 하나의 컨슈머가 소비하기 때문이며, 컨슈머의 사양을 높이는 것보다 그 수를 늘리는 것이 효과적일 수 있다.
  * 결국, **카프카의 높은 처리량을 보장하는 근간에는 아키텍쳐에 따라 컨슈머를 손쉽게 스케일 아웃할 수 있다는 특징**에 있다.
* **데이터 파이프라인에서 데이터를 수집할 경우 데이터의 정확한 양을 예측하기는 쉽지 않은 반면, 카프카는 가변적인 환경에서도 안정적으로 확장이 가능**하다.
  * 예를 들어, 데이터가 적다면 카프카 클러스터의 브로커는 최소한의 개수로 운영되지만 데이터가 늘어난다면 브로커의 개수를 손쉽게 스케일 아웃할 수 있다.
  * 반면 다시 **데이터의 수가 적어진다면 브로커의 개수가 자연스레 스케일 인되며, 나아가 이러한 모든 과정은 무중단 운영을 지원**한다.
* **카프카는 다른 메시징 플랫폼과 달리 메시지를 메모리가 아닌 파일 시스템에 저장하는 한 편, OS 차원에서 파일 시스템을 최대한 활용하여 성능을 보장**한다. 
  * 예를 들어 **OS에서는 디스크 IO 성능 향상을 위해 페이지 캐시 영역을 메모리에 따로 생성하여 사용**한다.
  * 이렇듯 페이지 캐시를 활용하는 카프카는 한 번 조회한 데이터는 메모리에 적재하여 재사용하며, 브로커가 예기치 못하게 종료되더라도 데이터는 유실되지 않는다.
* **카프카 클러스터는 기본적으로 셋 이상의 서버로 구성되어 운영되므로, 일부 서버에 장애가 발생하더라도 무중단으로 운영을 지속**할 수 있다.
  * 이렇듯 **클러스터로 구성되는 카프카는 하나의 브로커로 전송된 데이터를 또 다른 브로커에도 저장하는 데이터 복제를 활용하여 높은 고가용성을 보장**한다.
  * 또한 특정한 브로커 옵션을 통해 온프레미스 환경의 서버 랙함 또는 클라우드 상의 리전 단위의 장애 상황에서도 데이터를 안전하게 복제할 수 있다.