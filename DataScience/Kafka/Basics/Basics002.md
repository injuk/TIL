# Basics
## 2023-02-16 Thu
### 카프카 클러스터 운영 방식
* 카프카 클러스터를 직접 운영하는 경우, 다음과 같은 방식을 고려할 수 있다.
  1. 직접 서버에 설치한 후에 운영
  2. 또는 SaaS형 서비스를 도입
* 직접 서버에 설치하는 방식의 경우 설정을 세부적으로 최적화하여 최고의 성능으로 클러스터를 활용할 수 있으나, 운영자의 노하우가 지대한 영향을 미친다.
  * 반면, 컨플루언트 클라우드나 AWS MSK 등의 SaaS 서비스를 사용하는 경우 누구나 쉽고 빠르게 카프카 클러스터를 운영할 수 있다.
* 또한, 카프카는 다시 Apache가 제공하는 오픈소스 카프카와 컨플루언트가 제공하는 기업용 카프카로 분류될 수 있다.
  * 이 경우, 기업용 카프카는 커넥트 또는 모니터링 측면에서 이점이 있다.

### 카프카 클러스터 운영 시 하드웨어 권장 사양
* 컨플루언트의 경우, 상용 환경에서 카프카 클러스터를 운영하는 경우 다음과 같이 비교적 고성능의 브로커 서버 설정을 권장한다.
  1. 메모리: 32GB를 할당하되, 6GB는 힙 메모리로 설정하고 그 외는 OS의 페이지 캐시 용도로 사용
  2. CPU: 24코어를 할당하되, SSL과 같은 보안 설정을 사용하는 경우 더 높은 사양을 적용
  3. 디스크: RAID 10을 사용하는 디스크를 사용하되, NAS는 사용하지 않아야 함
  4. 파일 시스템: XFS 또는 ext4를 사용
* 특히, 페이지 캐시 영역의 메모리는 OS가 관리하며 프로듀서 또는 컨슈머 간의 상호작용시 힙 메모리 대신 사용하여 성능을 높이는 용도로 사용될 수 있다.
  * 이렇듯 대부분의 메모리 영역을 페이지 캐시 용도로 사용하므로, 실제 데이터 처리량은 더 높아지는 효과를 얻을 수 있다.
* 또한 카프카 클러스터에 포함되는 브로커의 개수는 개발 환경인 경우 5대, 운영 환경인 경우 10대가 권장된다. 
  * 그러나 앞서 다룬 바와 같이 카프카 클러스터에 포함된 브로커의 scale out은 쉬운 편에 속하므로, 정확히 몇 대를 유지할지에 대한 많은 고민은 필요가 없다.
* 나아가 디스크의 경우, 정확히 어느 정도의 용량을 권장하는지에 대한 기준은 없으므로 환경 및 실제 사용량에 따라 결정하는 것이 바람직하다.

## 2023-02-17 Fri
### 컨플루언트 카프카
* 컨플루언트는 카프카 생태계를 발전시키는데 핵심적인 역할을 맡는 회사이며, SaaS형 카프카 제품을 제공한다.
  * 예를 들어, 오픈소스 프로젝트가 활성화되려면 해당 프로젝트 뿐만 아니라 이를 돕는 주변 도구들이 많이 개발될 필요가 있다.
  * 카프카 역시 ksqlDB와 커넥터 등 카프카 생태계를 구성하는 여러 도구들이 있으며, 컨플루언트는 이러한 도구들의 개발에도 핵심적인 역할을 수행한다.

### 컨플루언트 카프카 플랫폼
* 컨플루언트 카프카는 다음과 같은 두 가지 플랫폼 형태를 제공한다.
  1. 클라우드 기반 클러스터
  2. 온프레미스 기반 설치형 클러스터
* 이 때, 클라우드 기반 클러스터는 그 특성에 따라 SaaS형 제품으로서 탄력적인 리소스를 제공한다.
* 반면, IaaS와 온프레미스 기반의 카프카 클러스터는 지속적으로 디스크 사용량을 모니터링하고 적절한 할당량을 고민할 필요가 있다.
  * 그러나 SaaS형 카프카 클러스터를 사용하는 경우 디스크 사용량에 대한 제한이 사실상 없으므로 프로듀서와 컨슈머는 브로커와 제한 없이 상호작용할 수 있다.
* 일반적으로 비즈니스에 아무런 제약이 없는 경우에는 SaaS형 플랫폼이 권장된다.
  * 반면, 데이터가 해외에 저장되지 않아야 하거나 이미 온프레미스 환경을 구축한 경우에는 온프레미스 기반의 카프카 클러스터를 고려할 수 있다.

### AWS MSK란?
* AWS MSK는 컨플루언트와 유사하게 AWS 자체적으로 제공하는 SaaS형 카프카 서비스를 의미한다.
  * 이 때, 해당 서비스는 기본적으로 관리형 서비스이므로 운영자는 간편하게 클러스터를 운영할 수 있다.
  * 예를 들어, 카프카 클러스터 운영 담당자는 주키퍼 등의 애플리케이션을 관리할 필요가 없다.
* 또한 MSK는 AWS에서 제공되는 여러 서비스와 간단한 연동이 가능하므로, 이미 AWS를 사용 중인 기업은 MSK의 사용을 우선적으로 고려할 수 있다.

## 2023-02-18 Sat
### SaaS형 카프카 클러스터의 장점
* SaaS형 카프카 클러스터를 관리할 경우, 기본적으로 최소 3대의 브로커 서버를 운영하는 운영 담당자 입장에서의 부담은 크게 줄어들 수 있다.
  * 예를 들어, 브로커 서버 중 하나에 이슈가 발생하더라도 담당자가 이를 직접 모니터링하고 복구할 필요는 없다.
  * 나아가 브로커 서버의 스케일 아웃 역시 온프레미스 환경에 비해 간단하며, 이로 인해 운영 담당자는 카프카 클러스터의 관리로부터 상당 부분 자유로울 수 있다.
* 또한 운영자가 활용할 수 있는 모니터링 대시보드가 제공되며, 운영에 필요한 여러 지표를 손쉽게 얻을 수 있어 관리 난이도는 상대적으로 낮아질 수 밖에 없다.
  * 반면, 이러한 모니터링 도구의 부재는 오픈소스로 제공되는 카프카 클러스터의 한계이기도 하다.
* 카프카 클러스터 역시 보안을 중시해야 하며, 적절한 설정을 하지 않을 경우 공격자는 호스트 정보와 포트 만으로도 토픽의 모든 데이터를 탈취할 수 있다.
  * 나아가 admin API를 통해 클러스터 자체에 악의적인 공격을 수행할 수도 있다.
  * 이러한 상황을 미연에 방지하기 위해서는 적절한 방어책 설정이 필수적이며, SaaS형 플랫폼은 이러한 보안 설정을 기본적으로 제공한다는 점에서 의미가 있다.

### SaaS형 카프카 클러스터의 단점
* 이러한 관리형 서비스의 특징이 으레 그렇듯, SaaS형 카프카 클러스터는 많은 편의 기능과 운영 용이성을 제공하는 대신 높은 유지 비용을 필요로 한다.
  * 예를 들어, 동일 사양의 브로커 서버를 구성할 때 AWS EC2로 직접 구성하여 운영하는 비용에 비해 AWS MSK로 운영하는 비용은 2배에 달한다.
* 또한 SaaS형 카프카 클러스터는 직접 운영하는 것에 비해 세부적인 설정을 적용하는 것이 어려우며, 멀티 클라우드 또는 하이브리드 클라우드 구성이 불가능하다.
  * 이로 인해 클라우드 종속성이 발생할 수 밖에 없으며, 마이그레이션 역시 쉽지 않은 문제가 될 수 있다.

### 카프카 클러스터 운영 형태 결정하기 
* SaaS형 카프카 클러스터는 명확한 장단점을 갖기에, 카프카 클러스터 운영 노하우 자체가 부족한 경우라면 좋은 선택지가 될 수 있다.
  * 그러나 이 역시도 카프카 클러스터라는 본질은 다름이 없으므로, 카프카에 대한 노하우가 없다면 세세한 운영에 어려움을 겪을 수 있다.
  * 반면, 카프카 클러스터 운영에 대한 이해가 깊은 사용자라면 SaaS형 카프카 클러스터가 제공하는 여러 편의 기능을 안전하게 누릴 수 있게 된다.
* 카프카 클러스터의 운영 형태를 결정하는 경우 반드시 운영 담당자의 이해도와 운영 비용, 추후 발생할 여러 이슈를 모두 고려하여 검토하는 것이 바람직하다.
  * 이렇듯 신중하게 진행하는 검토 과정은 곧 안정적인 서비스 운영의 밑바탕이 될 수 있으므로 매우 중요하다.