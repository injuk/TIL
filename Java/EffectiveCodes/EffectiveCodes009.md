# EffectiveCodes
## 2022-03-14 Mon

## 예외
### 예외는 정말 예외인 상황에만 사용하기
* 예외는 반드시 예외 상황에서만 사용해야 하며, 절대 애플리케이션의 흐름을 제어하기 위한 용도로 사용하지 말아야 한다.
  * 나아가 잘 설계된 API는 클라이언트가 정상적인 흐름에서 예외를 사용할 일이 없어야 한다.

### 복구 가능한 경우에는 검사 예외를, 프로그래밍 오류에는 런타임 예외를 사용하기
* Java는 문제 상황을 알리는 타입인 throwable로 검사 예외, 런타임 예외, 에러를 제공한다.
* 이 중, 호출하는 쪽에서 복구하리라고 여겨지는 상황에서는 검사 예외를 사용한다.
  * 검사 예외를 던지면 호출자가 해당 예외를 처리하거나 바깥으로 다시 던지도록 강제하게 된다.
  * **즉, 검사 예외는 API 설계자가 API 사용자에게 예외 상황으로부터의 회복을 강제**한다.
  * **때문에 메소드 선언에 포함된 검사 예외 각각은 메소드 호출시 발생할 수 있는 결과 중 하나임을 API 사용자에게 알리는 역할을 한다**.
* 비검사 throwable인 런타임 예외와 에러는 동작 측면에서는 큰 차이점이 없다.
* **프로그램이 던진 비검사 예외 또는 에러의 경우, 복구가 불가능하거나 더 실행해도 손해가 더 큰 경우를 말한다**.
* 프로그래밍 오류는 런타임 예외를 사용하여 표현한다.
  * 예를 들어, API 사용의 전제조건을 만족하지 못하는 경우에는 런타임 예외를 활용할 수 있다.
* **예외 상황으로부터 복구가 가능한 것으로 보인다면 검사 예외를, 그렇지 않거나 확실하지 않은 경우네는 비검사 예외를 선택하도록 한다**.
* 에러는 일반적으로 JVM이 더 이상 수행을 계속할 수 없는 상황을 나타내기 위해 사용하며, 일반적으로 상속하여 하위 클래스를 만들지 않는다.
  * 즉, **개발자가 직접 구현하는 비검사 throwable은 모두 RuntimeException의 하위 클래스여야 한다**.
* 검사 예외도 아니고 런타임 예외도 아닌 throwable은 정의하지 말아야 한다.
  * 이러한 방식은 검사 예외보다 좋은 게 없으면서 사용자를 헷갈리게 한다.
* **검사 예외를 직접 정의하는 경우, 예외 상황에 대한 정보 및 예외로부터 회복하기 위해 필요한 정보를 제공할 수 있는 메소드를 정의하는 것이 바람직**하다.
  * 그렇지 않을 경우 예외로부터 발생한 메시지를 토대로 필요한 정보를 파싱해야 하는데, 이는 바람직하지 않은 상황이다.
  * 메시지 문자열을 파싱하여 얻은 코드는 모든 환경에서 일관적으로 동작하지 못할 수 있다.

### 필요 없는 검사 예외의 사용은 지양하기
* 검사 예외는 제대로 활용하면 API의 질과 안정성을 높일 수 있다.
* **그러나 검사 예외를 과하게 사용하면 API의 사용성만을 떨어트린다**.
  * 예를 들어, API 사용자는 검사 예외를 처리하기 위해 catch 블록을 두어 처리하거나, 바깥으로 재전파해야 한다.
  * 어느쪽이든 API 사용자 입장에서는 예외 처리를 위한 부담 요소이며, 이는 특히 메소드가 단 하나의 검사 예외를 던지는 경우에서 가장 크다.
* API를 제대로 사용해도 발생할 수 있는 예외이거나, 개발자가 조치를 취할 수 있는 경우라면 검사 예외를 사용해도 무방하다.
  * 둘 모두에 해당하지 않는 경우, 비검사 예외를 사용하는 것이 좋다.
* **검사 예외를 회피하는 가장 쉬운 방법은 적절한 타입을 담는 옵셔널을 반환하는 방법이다**.
  * **이러한 방식은 예외가 발생한 이유를 명시하는 부가 정보를 포함할 수 없다는 단점도 존재**한다.
* 또는 검사 예외를 던지는 메소드를 2개로 쪼개어 비검사 예외로 리팩토링할 수도 있다.
  * 쪼개진 메소드 중 첫 번째는 예외 여부를 boolean 형태로 반환하는 메소드이며, 두 번째 메소드는 기존 메소드의 기능을 담당한다.
  * 이러한 리팩토링은 모든 상황에 적용할 수 없지만, 적용한 경우에는 API의 사용성을 높여줄 수 있다.
* 이러한 리팩토링은 외부 동기화 없이 여러 스레드에서 사용하는 경우, 또는 외부 요인에 의해 상태가 변할 수 있는 경우에 적합하지 못하다.
  * 예외 상황을 체크하는 메소드와 실제 동작을 수행하는 메소드 사이에서 상태가 변경될 수 있기 때문이다.

### 검사 예외의 결론
* 적시에 사용한 검사 예외는 프로그램의 안전성을 높이지만, 남용하면 API의 사용성만 떨어트릴 뿐이다.
* API 호출자가 예외로부터 복구할 방법이 없다고 판단되면 비검사 예외를 던진다.
* 복구가 가능하고 호출자가 해당하는 처리를 해주기를 바라는 경우라면, 우선 옵셔널 반환을 고려한다.
* 옵셔널만으로는 상황을 처리하기에 충분한 정보를 제공할 수 없는 경우에만 검사 예외를 던지도록 한다.