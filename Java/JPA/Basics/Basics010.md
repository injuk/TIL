# Basics
## 2022-07-31 Sun

### JPQL 경로 표현식
* **JPQL에서의 경로 표현식이란, `m.name`과 같이 참조 연산자를 활용하여 객체를 탐색하는 것**을 말한다.
* 이 때, 경로 표현식은 다음과 같이 구분할 수 있다.
  1. 상태 필드: 단순히 값을 저장하는 필드이다.
  2. 단일 값 연관 필드: 연관 관계를 위한 필드이며, @ManyToOne과 같이 대상이 엔티티인 경우에 사용한다.
  3. 컬렉션 값 연관 필드: 연관 관계를 위한 필드이며, @OneToMany와 같이 대상이 컬렉션인 경우에 사용한다.
* **상술한 세 방식은 어떤 종류를 사용하느냐에 따라 내부적인 동작 방식이 달라지므로, 반드시 이를 구분할 수 있어야** 한다.

### 경로 표현식의 특징
* 상태 필드의 경우, 경로 탐색의 끝에 해당하므로, 더 이상 탐색하지 않는다.
  * 예를 들어, `m.name`으로 탐색은 종료되며 name 뒤에 참조 연산자를 추가하여 더 탐색해나갈 수는 없다.
* 단일 값 연관 경로의 경우, **암시적인 inner 조인이 발생**하며, 추가적인 탐색이 가능하다.
  * 예를 들어, 탐색 대상이 엔티티이므로 `m.team.name`과 같이 추가 탐색이 가능하다.
  * 이렇듯 **객체에서는 참조 연산자를 통해 간단한 탐색이 가능하지만, 실제 데이터베이스에서는 반드시 조인이 발생한다는 사실을 기억**해야 한다.
  * 실무에서는 조인 자체가 성능에 지대한 영향을 주며, 반드시 쿼리 튜닝이 필요한 항목이므로 암시적인 조인이 발생하는 해당 방식은 사용에 주의를 기울여야 한다.
  * **이상적인 것은 암시적인 조인이 발생하지 않도록 하는 것이며, 가능한 한 JPQL과 SQL의 형태를 맞춰주는 것이 튜닝에 유리**하다.
* 컬렉션 값 연관 경로의 경우, **암시적인 inner 조인이 발생**하지만 참조 연산자를 활용하는 추가적인 탐색은 불가능하다.
  * 반면, `t.members.size`와 같이 컬렉션 자체의 크기를 구하는 것은 예외적으로 허용된다.
  * 요구 사항 **구현 과정에서 반드시 컬렉션 요소의 속성에 접근하고자 하는 경우, FROM 절에서 명시적으로 조인하여 별칭을 통해 탐색이 가능**하다.
* 상술했듯, **실무에서는 위험성이 큰 암시적인 조인이 발생하는 방식을 사용하지 말고 필요한 경우에 명시적으로 조인하는 방식이 권장**된다.
  * 때문에 JPQL과 SQL의 형태를 맞춰주는 것은 쿼리 튜닝이 쉬워진다는 점에서 중요하다.

### 명시적 조인과 암시적 조인
* 명시적인 조인은 말 그대로 JOIN 키워드를 직접 명시하는 조인을 의미한다.
* 반면, 암시적인 조인의 경우 경로 표현식에 의해 암시적인 SQL inner 조인이 발생하는 경우를 말한다.
  * 이 때, 경로 표현식에 의한 조인은 inner 조인만 가능하다.
  * 경로 표현식에 있어 암시적인 outer 조인은 불가능하며, 필요한 경우에는 반드시 명시적인 조인을 사용해야 한다.

### 경로 탐색을 사용하는 암시적인 조인 시 주의사항
* 경로 탐색 과정에서 발생한 암시적인 조인은 항상 inner 조인이다.
* 컬렉션 값 연관 필드의 경우 경로 탐색이 종료되며, 추가 탐색을 원하는 경우에는 명시적인 조인을 통해 별칭을 얻어야 한다.
* **경로 탐색은 SELECT, WHERE 절에서만 사용하지만 암시적인 조인으로 인해 SQL의 FROM, JOIN 절에 영향**을 준다.
* **실무에서는 가능하다면 암시적 조인보다는 명시적인 조인을 사용**해야 한다.
  * **조인은 SQL 튜닝에 있어 매우 중요한 포인트이며, 암시적인 조인을 사용하는 경우 조인이 발생하는 시점을 코드 상에서 한 눈에 파악하기 어렵다**.